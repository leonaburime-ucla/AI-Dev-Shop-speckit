# Tasks: FEAT-001 CSV Export for Invoice List

- Feature: FEAT-001
- Spec version: 1.1.0
- Spec hash: sha256:a3f8c2d1e4b7091f56ac83e29d047b5f1c6e82a4d9f3071b2c5e8d4a7f1b6c9
- ADR hash: sha256:b9e2d4f7a1c8053e67bd94f2a105c8e3d7f2093a5b8e4162c9d7f3b0e2a5c8f
- Generated by: Coordinator
- Generated at: 2026-02-22T03:00:00Z

---

## Phase 0 — Setup

No setup required. No new dependencies, no schema migrations, no environment changes.

---

## Phase 1 — Foundational (must complete before Phase 2)

These tasks establish the core logic. Phase 2 is blocked until Phase 1 is complete.

**[P] TASK-1.1 — Write failing tests for `formatCsv`**
AC coverage: AC-05, AC-06, AC-07, AC-08, INV-01, INV-02, EC-01, EC-02
File: `src/features/invoice-list/utils/formatCsv.test.ts`
Agent: TDD
Notes: Tests must fail before Programmer dispatch. Pure function tests — no DOM or component setup needed.

**[P] TASK-1.2 — Write failing tests for `triggerDownload`**
AC coverage: AC-01 (download initiates), INV-03 (no state mutation)
File: `src/features/invoice-list/utils/triggerDownload.test.ts`
Agent: TDD
Notes: Mock `URL.createObjectURL` and `URL.revokeObjectURL`. Verify Blob content type and that the anchor click is triggered.

**[P] TASK-1.3 — Write failing integration test for export button**
AC coverage: AC-01, AC-02, AC-03, AC-04, AC-08
File: `src/features/invoice-list/components/InvoiceList.integration.test.tsx`
Agent: TDD
Notes: Render `InvoiceList` with fixture data. Click Export button. Assert downloaded filename and CSV content against AC criteria. Use synthetic data only (see data-classification.md).

> **CHECKPOINT after Phase 1:** Human reviews test certification before Programmer dispatch.

---

## Phase 2 — Implementation

Blocked until Phase 1 TDD certification is complete and human-approved.

**TASK-2.1 — Implement `formatCsv`**
Spec refs: REQ-03, REQ-04, REQ-05, INV-01, EC-01, EC-02
File: `src/features/invoice-list/utils/formatCsv.ts`
Agent: Programmer
Notes: Pure function. RFC 4180 escaping. Implement until TASK-1.1 tests pass.

**TASK-2.2 — Implement `triggerDownload`**
Spec refs: REQ-01
File: `src/features/invoice-list/utils/triggerDownload.ts`
Agent: Programmer
Blocked by: TASK-2.1 (import dependency)
Notes: Blob creation, anchor click pattern, URL revocation.

**TASK-2.3 — Implement filename generation**
Spec refs: REQ-02, AC-03, AC-04
File: inline in Export button handler or extracted as `buildExportFilename.ts` if needed
Agent: Programmer
Notes: Use `Intl.DateTimeFormat` for local date. Read filter active state from InvoiceList props or context — do not add new state.

**TASK-2.4 — Add Export button to InvoiceList toolbar**
Spec refs: REQ-01, INV-03
File: `src/features/invoice-list/components/InvoiceList.tsx`
Agent: Programmer
Blocked by: TASK-2.1, TASK-2.2, TASK-2.3
Notes: Wire button click to `formatCsv` → `triggerDownload` sequence. Emit analytics event `invoice_list.export_csv` with `{ row_count, filter_active }`. Do not modify data fetching or filtering logic.

> **CHECKPOINT after Phase 2:** Human reviews test results (target: 90–95% P1 ACs passing) before Code Review dispatch.

---

## Parallelization Rules

- TASK-1.1, TASK-1.2, TASK-1.3 are independent and can run in parallel (`[P]`)
- TASK-2.1 and TASK-2.2 can begin in parallel (no import dependency between them at authoring time, but TASK-2.2 imports TASK-2.1's output — sequence them in practice)
- TASK-2.3 is independent of TASK-2.1 and TASK-2.2
- TASK-2.4 is blocked on TASK-2.1, TASK-2.2, and TASK-2.3

---

## Task Status Tracking

| Task | Agent | Status | Spec ACs | Notes |
|------|-------|--------|---------|-------|
| TASK-1.1 | TDD | pending | AC-05, AC-06, AC-07, AC-08, INV-01, INV-02, EC-01, EC-02 | |
| TASK-1.2 | TDD | pending | AC-01, INV-03 | |
| TASK-1.3 | TDD | pending | AC-01, AC-02, AC-03, AC-04, AC-08 | |
| TASK-2.1 | Programmer | pending | REQ-03, REQ-04, REQ-05 | blocked on Phase 1 |
| TASK-2.2 | Programmer | pending | REQ-01 | blocked on Phase 1 |
| TASK-2.3 | Programmer | pending | REQ-02 | blocked on Phase 1 |
| TASK-2.4 | Programmer | pending | REQ-01, INV-03 | blocked on 2.1–2.3 |
